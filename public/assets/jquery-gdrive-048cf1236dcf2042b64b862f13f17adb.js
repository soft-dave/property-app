!function(e){function t(e){return n(),null!=a.authtok&&null!=a.user?void(e&&e()):(a.debug&&console.log("invoking autorization"),void gapi.auth.authorize({client_id:a.appid,scope:a.scope,immediate:!1},function(t){t&&!t.error?(a.authtok=t.access_token,i(e)):console.log("Could not authenticate you with Google")}))}function i(e){gapi.client.setApiKey(a.devkey),gapi.client.load("oauth2","v2",function(){gapi.client.oauth2.userinfo.get().execute(function(t){a.user=t.email,e&&e()})})}function n(){3!=(3&a.init_stage)&&(1&a.init_stage||gapi.load("auth",{callback:function(){a.init_stage|=1}}),2&a.init_stage||gapi.load("picker",{callback:function(){a.init_stage|=2}}))}function o(t,i){if(i.action==google.picker.Action.PICKED){{var n=i[google.picker.Response.DOCUMENTS][0].thumbnails[3],o=i.docs[0];o.id,o[google.picker.Document.URL],o[google.picker.Document.NAME]}e("#"+t).val(n.url),e("#img_"+t).attr("src",n.url),e("#img_"+t).attr("height","110px"),e("#img_"+t).attr("width","223px")}}function l(t){e("#"+t).val("");var i=r[t],n=new google.picker.DocsView(google.picker.ViewId.PHOTO_ALBUMS);n.setMode(google.picker.DocsViewMode.LIST),"application/vnd.google-apps.folder"==i.filter&&(n.setSelectFolderEnabled(!0),n.setMimeTypes("application/vnd.google-apps.folder"));var o=(new google.picker.PickerBuilder).enableFeature(google.picker.Feature.NAV_HIDDEN).disableFeature(google.picker.Feature.MULTISELECT_ENABLED).setAppId(a.appid).addView(n).setOAuthToken(a.authtok).setDeveloperKey(a.devkey).setCallback(function(e){a.callback(t,e)}).setSize(a.width,a.height).setTitle(i.header);return null!=a.user&&o.setAuthUser(a.user),u=o.build(),u.setVisible(!0),u}var u=null,a={devkey:null,appid:null,user:null,scope:"https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/photos",authtok:null,init_stage:0,width:800,height:400,callback:o,debug:!1},r={};e.fn.gdrive=function(i,o){if("init"===i)return a=e.extend(a,o),n(),this;if("set"===i)return this.each(function(){var i=e(this).attr("id"),n=e.extend(e.extend(r[i],{trigger:null,header:"",filter:""}),o);r[i]=n;var a=null==n.trigger?i:n.trigger;e("#"+a).click(function(){t(function(){u=l(i)})})});if("show"===i){var c=this.attr("id");return t(function(){u=l(c)}),this}if("hide"===i)return null!=u&&(u.setVisible(!1),u=null),this;if("token"==i)return a.authtok;if("user"==i)return a.user;if("setauth"==i){var s=e.extend({uid:null,token:null,callback:null},o),g=s.uid,d=s.token,p=s.callback;t(function(){null!=g&&e("#"+g).val(a.user),null!=d&&e("#"+d).val(a.authtok),null!=p&&p()})}return"debug"==i?a:void 0}}(jQuery);